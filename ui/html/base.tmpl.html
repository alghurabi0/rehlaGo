{{ define "base" }}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <link rel="stylesheet" href="/static/css/tailwind.css" />
    <link rel="manifest" href="/static/web.webmanifest" />
    <script
      src="https://unpkg.com/htmx.org@1.9.12"
      integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/hyperscript.org@0.9.13"></script>
    <script type="module" src="/static/js/base.js"></script>
    <script src="sw-register.js"></script>
    <title>{{template "title" .}} - Rehla</title>
  </head>

  <body
    class="h-screen min-h-screen select-none bg-white font-sans leading-normal tracking-normal"
  >
    <main
      class="mx-auto overflow-y-scroll h-screen rounded-lg shadow-lg md:max-w-5xl"
      _="on htmx:responseError 
      if event.detail.xhr.responseText is 'loginRequired' 
      then log 'login required' 
      then call #loginDialog's showModal()
      then add .flex to #loginDialog
      then remove .hidden from #loginDialog
      else if event.detail.xhr.responseText is 'subRequired'
      then log 'subscription required'
      then call #subDialog's showModal()
      then add .flex to #subDialog
      then remove .hidden from #subDialog"
    >
      <div class="w-full p-4">
        {{ template "nav" . }} {{ template "main" . }}
      </div>
      {{ template "loginRequired" }} {{ template "subRequired" }} {{ template
      "tabNav" . }} {{ template "nav_drawer" . }}
    </main>
    <script type="text/hyperscript">
      on load or popstate or htmx:afterRequest
      set myRoute to window.location.pathname
      if myRoute is "/"
          set '#ADADAD' to (<path/> in #nav_tab).fill
          set '#612C8C' into (<path/> in #home_nav_tab).fill
      else if myRoute matches "^/courses"
          set '#202020' to (<path/> in #nav_drawer).fill
          set '#612C8C' into (<path/> in #courses_nav_tab).fill
      else if myRoute matches "^/materials"
          set '#202020' to (<path/> in #nav_drawer).fill
          set '#612C8C' into (<path/> in #materials_nav_tab).fill
      else if myRoute matches "^/progress"
          set '#202020' to (<path/> in #nav_drawer).fill
          set '#612C8C' into (<path/> in #progress_nav_tab).fill
      else if myRoute matches "^/myprofile"
          set '#202020' to (<path/> in #nav_drawer).fill
          set '#612C8C' into (<path/> in #profile_nav_tab).fill
      end
    </script>
  </body>
</html>
{{ end }}
